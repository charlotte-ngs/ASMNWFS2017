---
title: "Angewandte Statistische Methoden in den Nutztierwissenschaften"
author: "Peter von Rohr"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
output: bookdown::gitbook
documentclass: book
bibliography: ["ASMNW.bib"]
biblio-style: apalike
link-citations: yes
description: "Unterlagen zur Vorlesung Angewandte Statistische Methoden in den Nutztierwissenschaften."
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::knit_hooks$set(conv.odg = rmddochelper::odg.graphics.conv.hook)
r6objTableAbbrev <- rmddochelper::R6ClassTableAbbrev$new()
```

# Vorwort {-}
Dieses Dokument umfasst die kompletten Unterlagen zur Vorlesung __Angewandte Statistische Methoden in den Nutztierwissenschaften__. Der Titel dieser Vorlesung ist sehr allgemein gehalten. Dies würde es erlauben einen grosszügigen Überblick über eine breite Palette an statistischen Methoden, welche in den Nutztierwissenschaften eingesetzt werden, zu geben. 

Wir schlagen an dieser Stelle aber einen anderen Weg ein, und fokussieren uns auf die statistischen Methoden in der genomischen Selektion. Nur diese bewusste Wahl eines spezifischen Gebietes ermöglicht es uns, den behandelten Stoff angemessen zu vertiefen. Im anschliessenden Unterabschnitt wollen wir die hier getroffene Entscheidung der Fokusierung auf die genomische Selektion motivieren. Dabei wird klar, dass wir mit der Wahl des Themas der multiplen linearen Regression als Ausgangspunkt auch eine Leserschaft ansprechen, welche nicht primär an der Tierzucht interessiert ist.


## Motivation {-}
Vom Standpunkt der statistischen Modellierung, ist das einfache lineare Modell mit fixen Effektstufen für den Einsatz in der genomischen Selektion ausreichend. Diese Art von Modellen werden auch als Regressionsmodelle bezeichnet. Die Problematik entsteht erst bei der Technik, welche wir für die Schätzung der unbekannten Parameter verwenden können. In der klassischen Regressionsanalyse ist die Methode der kleinsten Quadrate (Least Squares) die Methode der Wahl. Least Squares können wir aber für die genomische Selektion nicht verwenden, da die Anzahl unbekannter Parameter ($p$) grösser ist als die Anzahl Beobachtungen ($n$). 

Mit der steigenden Grösse und Komplexität von aktuellen Datensätzen tritt das soeben beschriebene Problem nicht nur in der Tierzucht auf, sondern es gibt eine breite Palette von Anwendungen. In der Vorlesung beschrieben wir diese Problematik am Beispiel der genomischen Selektion und es werden alternative Techniken zur Schätzung von Parametern vorgeschlagen. Da die Methode der multiplen Regressionsanalyse in früheren Vorlesungen behandelt wurde, bietet diese ein idealer Ausgangspunkt für den in dieser Veranstaltung präsentierten Stoffinhalt.


## Einordnung {-}
Die Vorlesung __Angewandte Statistische Methoden in den Nutztierwissenschaften__ ist eine halb-semestrige Veranstaltung und wird im Masterstudiengang Agrarwissenschaften der ETH Zürich angeboten.


## Lernziele {-}
Für die Verwendung des hier präsentierten Stoffs schlagen wir die folgenden Lernziele vor. 

Die Studierenden ...

- kennen die Eigenschaften der multiplen linearen Regression und 
- können einfache Datensätze mithilfe der Regressionsmethode analysieren 
- wissen wieso multiple lineare Regressionen bei der genomischen Selektion nicht brauchbar ist 
- kennen die in der genomischen Selektion verwendeten statistischen Verfahren, wie
    + BLUP-basierte Verfahren, 
    + Bayes'sche Verfahren und 
    + die LASSO Methode 
- können einfache Übungsbeispiele mit der Statistiksoftware R erfolgreich bearbeiten.


<!--chapter:end:index.Rmd-->

# Einführung {#intro}

Den in dieser Vorlesung präsentierte Stoff kann aus mehreren Gesichtspunkten betrachtet werden. Aus Sicht der Tierzucht behandeln wir die statistischen Methoden, welche in der __genomischen Selektion__ angewendet werden. Für Statistiker stellen wir verschiedene Methoden der Regularisierung in hoch-parametrischen Modellen vor. In der sehr populären Disziplin des __Machine Learnings__ wird das hier besprochene Problem als die Selektion von relevanten Features im Kontext des Supervised Learnings dargestellt.


## Beschreibung des Problems {#problem}
Alle die soeben genannten Formulierungen beschreiben das gleiche Problem. Wir gehen von einem Datensatz aus, welcher aus Beobachtungen besteht. Jede Beobachtung ist charakterisiert durch sehr viele unabhängige Grössen. Die Gewichtung der zu einer Beobachtung gehörenden Grössen wird über unbekannte Parameter erreicht. 

Als Beispiel für einen solchen Datensatz können wir eine Population mit SNP-typisierten Tieren betrachten. Das Typisierrungsergebnis für ein bestimmtes Tier enthält die Genotypen an den Genorten, welche bei der Typisierung untersucht werden. Die einzelnen Genorte werden als sogenannte Single Nucleotide Polymorphisms (SNP) bezeichnet. In Abhängigkeit des anbietenden Labors gibt es verschiedene Optionen für die gewünschte Typisierung. Die Optionen unterscheiden sich vor allem in der Dichte der untersuchten Genorte. Das heisst bei einer grösseren Dichte werden mehr SNPs untersucht. Typische Werte von gängigen Anbietern bewegen sich im Bereich zwischen 50000 (50K) bis rund 800000 (800K) untersuchte SNPs pro untersuchtes Genom. Die totale Anzahl an SNP im Genom beträgt rund 20 Millionen. Somit ist ein Typisierungsergebnis eine vom Anbieter gemachte Auswahl aller verfügbaren SNPs.


## Rückblick {#background}
Bis Anfangs des 21. Jahrhundert wurden eigentlich keine genomischen Informationen in Zuchtprogrammen berücksichtigt. Mit genomischer Information ist hier die Genotyp-Varianten einer grosser Anzahl von Genorten, welche über das ganze Genom verteilt ist. Um die Jahrtausendwende waren sehr viele ForscherInnen in einem Gebiet aktiv, welches damals als Mapping von sogenannten `r r6objTableAbbrev$add_abbrev(psAbbrev = "QTL", psMeaning = "Quatitative Trait Loci")` bezeichnet wurde. Eine Übersicht zu QTL ist im Buch [@BBC2008]. Das Ziel der Untersuchungen im Bereich QTL-Mapping war das Finden von Regionen im Genom, welche wichtig sind für die Ausprägung von spezifischen Phänotypen. Heute spricht man nicht mehr QTL-Mapping sondern heute wird die Suche von genetischen Orten, welche einen wichtigen Einfluss auf die Ausprägung eines Phänotyps haben, mit `r r6objTableAbbrev$add_abbrev(psAbbrev = "GWAS", psMeaning = "Genome Wide Association Study")` bezeichnet. 

Trotz umfangreicher Forschungstätigkeit auf dem Gebiet des QTL-Mappings, fanden keine Resultate aus diesen Arbeiten den Weg in die praktische Zuchtarbeit. Somit verläuft die Zuchtarbeit bis vor kurzem nach dem klassischen Schema, welches nachfolgend gezeigt ist.

```{r ZuchtprogrammKomplett, conv.odg=TRUE, odg.path="odg", odg.graph.cache=TRUE, fig.align='center', echo=FALSE, results='asis'}
knitr::include_graphics(path = "ZuchtprogrammKomplett.pdf")
```

### Paradigmenwechsel
Die Publikation [@MHG2001] gilt als Grundstein für eine neue Ära in der praktischen Zuchtarbeit. Die Autoren haben gezeigt, wie genomische Information, welche in genügender Dichte vorliegen muss, zur Schätzung von Zuchtwerten verwendet werden kann. Sie konnten auch statistische Methoden zeigen, mit welchen die Parameter in verwendeten Modell geschätzt werden können. Wir werden zu einem späteren Zeitpunkt noch genauer auf den Inhalt des Papers von [@MHG2001] zurückkommen.


### Vor der genomischen Selektion
Von Anfangs der 1980-er Jahre wurden die statistischen Auswertungen in den Zuchtprogrammen auf das BLUP-Tiermodell abgestellt. In dieser Zeit wurden die einfachen Modelle auch durch verschiedene Erweiterungen ausgebaut. Bei der Milchproduktion wurde von einfachen Laktationsleistungen auf Testtagesmodelle umgestellt. Bei der Wurfgrösse beim Schwein oder anderen diskreten Merkmalen wurden auch `r r6objTableAbbrev$add_abbrev(psAbbrev = "GLMM", psMeaning = "Generalized Linear Mixed Models")` verwendet. Unabhängig von den verwendeten Modellen wurden in allen Auswertungen die gleichen Informationen berücksichtigt. 
- phänotypische Leistungen
- Pedigree
- Varianzkomponenten aus periodischen Schätzungen

Versuchsweise wurde ab den 1990-er Jahren erste genetische Marker mit in den Zuchtprogrammen berücksichtigt. Das Problem war dass diese wenigen Markern sehr schnell auf einer bestimmten Variante fixiert war. Nach der Fixierung lieferten diese Genorte keine zusätzliche Information zur Auswahl von potentiellen Zuchttieren. Es war zu dieser Zeit nicht klar, wie das Problem der Fixierung von einzelnen Genorten behandelt werden soll und es gab auch keine wirklich gute Strategie für die Berücksichtigung von genetischen Informationen in Zuchtprogrammen.


### Modellierung vor der genomischen Selektion
Vor der Einführung der genomischen Selektion war das BLUP-Tiermodell die Methode der Wahl für die Auswertung von Leistungsdaten in der Tierzucht. In seiner einfachsten Form sieht dieses Modell wie folgt aus.

$$\mathbf{y} = \mathbf{X} \mathbf{b} + \mathbf{Z} \mathbf{u} + \mathbf{e}$$

wobei: 
\begin{tabular}{ll} 
$\mathbf{y}$: & Vektor mit phänotypischen Beobachtungen\\ 
$\mathbf{b}$: & Vektor mit fixen Effekten              \\ 
$\mathbf{X}$: & Inzidenzmatrix, welche fixe Effekte den Beobachtungen zuordnet\\ 
$\mathbf{u}$: & Vektor mit Zuchtwerten (zufällig) \\ 
$\mathbf{Z}$: & Inzidenzmatrix der Zuchtwerte \\ 
$\mathbf{e}$: & Vektor mit Residuen (zufällig) 
\end{tabular}

Die Co-Varianzen der zufälligen Komponenten sind definiert als:

$$Var(\mathbf{e}) = \mathbf{R} = \mathbf{I}*\sigma_e^2$$ 
$$Var(\mathbf{u}) = \mathbf{G} = \mathbf{A} * \sigma_g^2$$
$$Cov(\mathbf{u},\mathbf{e}^T) = Cov(\mathbf{e}, \mathbf{u}^T) = \mathbf{0}$$
$$\rightarrow Var(\mathbf{y}) = \mathbf{V} = \mathbf{ZGZ}^T + \mathbf{R}$$


## Genomische Selektion {#gensel}
Vom Standpunkt der Genetik aus basiert das BLUP-Tiermodell auf dem sogenannten Infinitesimalmodell. In diesem Modell wird angenommen, dass die phänotypische Ausprägung eines Merkmals durch die Summe von unendlich vielen Genorten mit undendlich kleiner Wirkung verursacht wird. Durch diese Annahme lässt sich dem einzelnen Tier kein fix definierter Genotyp mehr zuordnen. Diese fehlende Zuordnung der einzelnen Genotypen wird über die Modellierung der Zuchtwerte als zufällige Effekte gelöst. Die zufälligen Effekte der Zuchtwerte entsprechen dabei Realisierungen einer Zufallsvariablen mit vorgegebener Verteilung. 

In der genomischen Selektion verwenden wir das polygene Modell. Dabei werden die phänotypischen Leistungen als Summe von bekannten Genorten zusammengesetzt. Die konkrete Umsetzung des polygenen Modells wurde zum ersten Mal im Paper von [@MHG2001] gezeigt. Diese Autoren haben aufgrund von simulierten Daten gezeigt, dass es mit Hilfe einer sehr dichten Markerkarte möglich ist, die phänotypischen Leistungen alleine aufgrund der geschätzten Wirkungen an den Markergenorten zu modellieren. 

Die folgende Abbildung fasst die Unterschiede zwischen dem Infinitesimalmodell und dem polygenen Modell zusammen.

```{r AnimalModelVsGenomicSelection, conv.odg=TRUE, odg.path="odg", odg.graph.cache=TRUE,fig.align='center', echo=FALSE, results='asis'} 
knitr::include_graphics(path = "AnimalModelVsGenomicSelection.pdf")
```


### Modellierung
Im Zusammenhang mit der genomischen Selektion besteht die Modellierung der Daten aus zwei Komponenten

1. Die Schätzung der Gen-Wirkungseffekte ($a$)
2. Die Schätzung der genomischen Zuchtwerte

Die Umsetzung der beiden Komponenten wird in zwei verschiedenen Verfahren gemacht. Im Zwei-Schritt-Verfahren werden beide Komponenten einzeln an verschiedenen Teilen der Zuchtpopulation ausgeführt. Im Gegensatz dazu werden im Single-Step-Verfahren beide Komponenten im gleichen Schritt realisiert.


### Zwei-Schritt-Verfahren
Beim Zwei-Schritt-Verfahren wird die Population in ein Trainings- und ein Testset unterteilt. Im Trainingsset werden aufgrund von Typisierungsergebnissen und Beobachtungen die Gen-Wrkungseffekte ($a$) geschätzt. Sobald die Schätzwerte für die $a$-Effekte bekannt 
sind können diese für die Schätzung der genomischen Zuchtwerte verwendet werden.

Da aufgrund der Typisierungsergebnisse die Genotypen an den SNP-Genorten bekannt sind, brauchen wir kein gemischtes lineares Modell mehr. Im Gegensatz zur BLUP-Zuchtwertschätzung, ist in der genomischen Selektion beim Zwei-Schritt-Verfahren ein einfaches lineares Modell ausreichend. Im Idealfall, wenn die komplette Information zu allen Gen-Wirkungseffekten ($a$) bekannt sind, dann setzen sich die genotypischen Werte einfach zusammen aus den aufsummierten $a$-Werten. In Matrix-Vektor-Schreibweise können wir die folgende Modellgleichung aufstellen.

\begin{equation}
  g = 1\mu + Ma + \epsilon
  (\#eq:genselideal)
\end{equation}

wobei:
\begin{tabular}{ll}
$g$         &  Vektor von wahren genomischen Zuchtwerten \\
$\mu$       &  Achsenabschnitt \\
$a$         &  Vektor mit Gensubstitutionseffekten \\
$M$         &  Inzidenzmatrix als Verknüpfung zwischen $a$ und $g$ \\
$\epsilon$  &  Vektor von zufälligen Residuen 
\end{tabular}

Die Matrix $M$ ist eine Inzidenzmatrix, welche die genotypischen Werte im Vektor $g$ mit den Gen-Wirkungseffekten $a$ verknüpft. Die Matrix $M$ hat die Dimension $n\times p$ wobei $n$ der Anzahl Individuen mit einem Typisierungsergebnis entspricht und $p$ gleich der Anzahl SNP-Genorte ist.

In der Realität im ersten Schritt des Zwei-Schritt-Verfahrens kennen wir aber weder die Komponenten des Vektors $g$ noch die Gensubstitutionseffekte $a$. Somit müssen wir das Modell zur Schätzung der $a$-Effekte modifizieren. Bei der aktuellen Modifikation ersetzen wir den Vektor $g$ durch die phänotypischen Beobachtung $y$. 

\begin{equation}
  y = (1\mu + Xb) + Ma + (\epsilon+ e)
  (\#eq:genselphen)
\end{equation}  

wobei:
\begin{tabular}{ll}
$y$  &  Vektor der phänotypischen Beobachtungen \\
$b$  &  Vektor der fixen Umweltfaktoren \\
$X$  &  Inzidenzmatrix der fixen Effekte\\
$e$  &  Vektor von nicht-genetische Residuen
\end{tabular}



<!-- ------------------------------------------------------------------- --
  -- END of document:  Below this must not be anything, except the stuff --
  -- concerning the table of abbreviations                               --> 
  
\pagebreak  
  
```{r WriteTableOfAbbreviations, echo=FALSE, results='hide'}
if (!r6objTableAbbrev$is_empty_abbr())
  r6objTableAbbrev$writeToTsvFile()
```

```{r AbrTableToDocument, echo=FALSE, results='asis'}
r6objTableAbbrev$include_abbr_table(psAbbrTitle = "# Abkürzungen {-}")
```


```{r Bibliography, echo=FALSE, results='hide'}
bref <- c(bibentry(
     bibtype = "Article",
     title = "Prediction of total genetic value using genome-wide dense marker maps",
     author = c(as.person("Theo HE Meuwissen [aut]"), 
                as.person("Ben J Hayes [aut]]"),
                as.person("Mike E Goddard [aut]")),
     year = "2001",
     journal = "Genetics",
     number = "157",
     pages = "1819-1829",
     key = "MHG2001"),
  bibentry(
    bibtype = "Book",
    title = "Handbook of Statistical Genetics",
    editor = c(as.person("D. J. Balding"), as.person("M. Bishop"), as.person("C. Cannings")),
    year = "2009",
    publisher = "Wiley",
    doi = "10.1002/9780470061619",
    key = "BBC2008"
  )     
)

### # Fixed assignmen of bib file
sBibFile <- "ASMNW.bib"
if(!file.exists(sBibFile))
  cat(paste(toBibtex(bref), collapse = "\n"), "\n", file = sBibFile)
```

\pagebreak

`r if (knitr:::is_html_output()) '# References {-}'`

<!--chapter:end:01-intro.Rmd-->

